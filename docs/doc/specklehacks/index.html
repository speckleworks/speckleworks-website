
<html>
<head>
  <title>SpeckleCore (.NET) in Grashopper</title>
  <meta charSet="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="icon" type="image/png" href="https://speckle.works/img/logos/logo-xs.png">
  <link rel="apple-touch-icon" type="image/png" href="https://speckle.works/img/logos/2xlogo-white.png">
  <link rel="icon" sizes="144x144" href="https://speckle.works/img/logos/2xlogo-white.png">
  
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <link rel="stylesheet" href="/css/waffle-grid.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  
  <meta property="og:title" content="SpeckleCore (.NET) in Grashopper">
  <meta property="og:description" content="How to use the SpeckleCore .NET base api classes to talk directly with the Speckle API from a scripting component.">
  <meta property="og:image" content="https://speckle.works/img/datamodels.png">
  <meta property="og:url" content="https://speckle.works/doc/specklehacks/">

  <meta name="twitter:site" content="@idid">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://speckle.works/img/datamodels.png" />
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-96321582-1', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="navigation-header">
  <div class="grid section-block m-hide main-nav-header">
    <div class="row">
      <div class="col col-12-of-12">
        <nav class="sidebar-nav">
            
          <a class="sidebar-nav-item" href="/">  Speckle</a>   
          <a class="sidebar-nav-item" href="/blog/">  Blog</a>     
          <a class="sidebar-nav-item" href="/about/">  About</a>   
          <a class="sidebar-nav-item" href="/doc/">  Docs</a>   
          <a class="sidebar-nav-item" href="https://slacker.speckle.works/"> <i class='fa fa-slack'></i> Slack</a>   
          <a class="sidebar-nav-item" href="https://github.com/speckleworks"> <i class='fa fa-github'></i> Github</a>  
        </nav>
      </div>
    </div>
  </div>
  <div class="mobile-button add-shadow m-and-lower" id="menubutton">
    <img src="/img/logos/logo-xs.png" style="height: 20px;">
  </div>
  <div id="mobilemenu" class="grid mobile-menu m-and-lower">
    <div class="mobile-button-close" id="menubuttonclose">
      <i class="fa fa-close"></i>
    </div>
    <div class="row">
      <div class="col col-12-of-12 center-me-wrap">
        <nav class="sidebar-nav" style="width: 100%;">
            
          <a class="sidebar-nav-item" href="/">  Speckle</a>   
          <a class="sidebar-nav-item" href="/blog/">  Blog</a>     
          <a class="sidebar-nav-item" href="/about/">  About</a>   
          <a class="sidebar-nav-item" href="/doc/">  Docs</a>   
          <a class="sidebar-nav-item" href="https://slacker.speckle.works/"> <i class='fa fa-slack'></i> Slack</a>   
          <a class="sidebar-nav-item" href="https://github.com/speckleworks"> <i class='fa fa-github'></i> Github</a>  
        </nav>
      </div>
    </div>
  </div>
</div>
<div></div>
<div class="m-hide" style="height: 42px; pointer-events: none;">
</div>
<div></div>

  <div class="header-img" style='background: url("/img/datamodels.png") center center fixed  no-repeat'></div>
  
  <div class="article-title card-5">
    <h1>
      <strong>SpeckleCore (.NET) in Grashopper</strong>
    </h1>
    <subtitle>
      <p>
        <em>by <a href="https://twitter.com/idid" style='border: none; font-size: 16px;'>Dimitrie Stefanescu <i class='fa fa-twitter' style='color:#86AFFB'></i></a></em>
        <br>
        <small>6 min read. Posted on Wed, Oct 4, 2017</small>
      </p>
    </subtitle>
  </div>
  <div class="grid section-block article-block">
    <div class="row">
      
      <div class="col col-3-of-12 col-m-4-of-4 m-hide" >
          <div id='toc'>
          <h5>Contents</h5>
          <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#a-note-on-async-and-sync">A note on Async and Sync</a></li>
<li><a href="#login">Login</a></li>
<li><a href="#create-object">Create Object</a></li>
<li><a href="#create-many-objects">Create Many Objects</a></li>
<li><a href="#get-object">Get Object</a></li>
<li><a href="#get-many-objects">Get Many Objects</a></li>
<li><a href="#going-further">Going Further:</a></li>
</ul></li>
</ul>
</nav>
          </div>
      </div>
      <div class="col col-9-of-12 col-m-4-of-4 article">
        

<p>You can easily hack your own Speckle Components with the SpeckleCore BaseSpeckleApiClient class. Here are some really quick scripts I&rsquo;ve hacked up together in a c# scripting component.</p>

<p>It&rsquo;s a nice easy way of exploring the API, albeit you pay the price of fiddling around Grasshopper&rsquo;s event loop (or lack thereof).</p>

<h2 id="getting-started">Getting Started</h2>

<ol>
<li>Make sure you&rsquo;ve installed the <a href="https://github.com/speckleworks/SpeckleGrasshopper/releases">Speckle Grasshopper Components</a>.</li>
<li>Create a C#/VBÂ Scripting Component in Grasshopper.</li>
<li>Right Click, select &ldquo;Manage Assemblies&rdquo; and add the SpeckleCore.dll and SpeckleRhinoConverter.dll if needed.</li>
</ol>

<p>If you get stuck, <a href="/img/blobs/SpeckleCore.Hacks.gh">here is the grasshopper defintion!</a>!</p>

<p>Please note that you might need to set the &ldquo;Managed Assemblies&rdquo; of the scripting components, and don&rsquo;t forget to use your email and password that <strong>you have already registered with</strong> on the speckle server of your choice.</p>

<h2 id="a-note-on-async-and-sync">A note on Async and Sync</h2>

<p><strong>SpeckleCore</strong>&rsquo;s methods come in two falvours, <em>Sync</em> and <em>Async</em>. I will not go into details here, but if you don&rsquo;t want the UI stuck, you&rsquo;ll need to invoke off the main thread.</p>

<p>I&rsquo;ve ended up invoking them using either
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Rhino.RhinoApp.Invoke(</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Action(</span> <span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">=&gt;</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">var</span> <span style="color: #f8f8f2">response</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myClient.DoSomethingSync()</span>
<span style="color: #f8f8f2">}));</span>
</pre></div>

or:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">myClient.DoSomethingAsync.ContinueWith(</span> <span style="color: #f8f8f2">taskResult</span> <span style="color: #f8f8f2">=&gt;</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #75715e">//...</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
</p>

<p>You play.</p>

<h2 id="login">Login</h2>

<p>This script will send a login request to the server and return with you api token. It will also set the AuthToken field in the provided client, and output it too (so you can reuse it afterwards in the definiton without authenticating everytime).</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span> <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">RunScript</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Client,</span> <span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">Email,</span> <span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">Password,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Response,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">ClientOut)</span>
  <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">BaseSpeckleApiClient</span> <span style="color: #f8f8f2">myClient</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Client</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">BaseSpeckleApiClient;</span>

    <span style="color: #75715e">// Output stuff first, as we might return from the actual method and not get to the bottom</span>
    <span style="color: #f8f8f2">Response</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse;</span>

    <span style="color: #75715e">// If the response is not null, set the AuthToken value of the client and output it as well</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myResponse</span> <span style="color: #f8f8f2">!=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">myClient.AuthToken</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse.ApiToken;</span>
    <span style="color: #f8f8f2">ClientOut</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myClient;</span>

    <span style="color: #75715e">// check if we really need to invoke a new login:</span>
    <span style="color: #75715e">// 1) Are the inputs there?</span>
    <span style="color: #75715e">// 2) Are the inputs different than the last ones?</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">((Email</span> <span style="color: #f8f8f2">!=</span> <span style="color: #66d9ef">null</span> <span style="color: #f8f8f2">&amp;&amp;</span> <span style="color: #f8f8f2">Password</span> <span style="color: #f8f8f2">!=</span> <span style="color: #66d9ef">null</span> <span style="color: #f8f8f2">&amp;&amp;</span> <span style="color: #f8f8f2">myClient</span> <span style="color: #f8f8f2">!=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">&amp;&amp;</span> <span style="color: #f8f8f2">(_Email</span> <span style="color: #f8f8f2">!=</span> <span style="color: #f8f8f2">Email</span> <span style="color: #f8f8f2">||</span> <span style="color: #f8f8f2">_Password</span> <span style="color: #f8f8f2">!=</span> <span style="color: #f8f8f2">Password))</span>
    <span style="color: #f8f8f2">{</span>
      <span style="color: #75715e">// Store the inputs so we can compare new vs. old</span>
      <span style="color: #f8f8f2">_Email</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Email;</span> <span style="color: #f8f8f2">_Password</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Password;</span>

      <span style="color: #75715e">// Invoke the method from outside the main thread</span>
      <span style="color: #f8f8f2">Rhino.RhinoApp.MainApplicationWindow.Invoke(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Action(()</span> <span style="color: #f8f8f2">=&gt;</span>
        <span style="color: #f8f8f2">{</span>
        <span style="color: #75715e">// store the response</span>
        <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myClient.UserLogin(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">PayloadAccountLogin()</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">Email</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Email,</span> <span style="color: #f8f8f2">Password</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Password</span> <span style="color: #f8f8f2">});</span>
        <span style="color: #75715e">// trigger a component refresh</span>
        <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.Component.ExpireSolution(</span><span style="color: #66d9ef">true</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">}));</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">// &lt;Custom additional code&gt; </span>
  <span style="color: #f8f8f2">ResponseAccountLogin</span> <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>
  <span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">_Email,</span> <span style="color: #f8f8f2">_Password;</span>
  <span style="color: #75715e">// &lt;/Custom additional code&gt;</span>
</pre></div>


<h2 id="create-object">Create Object</h2>

<p>This script will take a GeometryBase object, convert it, and save it in the database. It will then output the saved SpeckleObject, complete with his <strong>DatabaseId</strong> (called <em>ObjectId</em> in the response).</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">RunScript</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Client,</span> <span style="color: #f8f8f2">GeometryBase</span> <span style="color: #f8f8f2">Obj,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Response,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">SpkObject)</span>
  <span style="color: #f8f8f2">{</span>
    <span style="color: #75715e">// set output first</span>
    <span style="color: #f8f8f2">Response</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse;</span>
    <span style="color: #f8f8f2">SpkObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myObject;</span>

    <span style="color: #75715e">// Get and cast the client</span>
    <span style="color: #f8f8f2">BaseSpeckleApiClient</span> <span style="color: #f8f8f2">myClient</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Client</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">BaseSpeckleApiClient;</span>

    <span style="color: #75715e">// Return if null</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myClient</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>

    <span style="color: #75715e">// Create a fresh converter if we don&#39;t have one</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myConverter</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RhinoConverter();</span>

    <span style="color: #75715e">// Exit if no object to send to the db</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(Obj</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>

    <span style="color: #75715e">// Convert the object</span>
    <span style="color: #f8f8f2">myObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myConverter.ToSpeckle(Obj);</span>

    <span style="color: #75715e">// Check if we have a new object</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myObject.Hash</span> <span style="color: #f8f8f2">!=</span> <span style="color: #f8f8f2">_myObject.Hash)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">Rhino.RhinoApp.MainApplicationWindow.Invoke(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Action(()</span> <span style="color: #f8f8f2">=&gt;</span>
        <span style="color: #f8f8f2">{</span>
        <span style="color: #75715e">// Create a payload and put in the converted object</span>
        <span style="color: #f8f8f2">PayloadSingleObject</span> <span style="color: #f8f8f2">myPayload</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">PayloadSingleObject()</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myObject</span> <span style="color: #f8f8f2">};</span>

        <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myClient.ObjectCreate(myPayload);</span>

        <span style="color: #75715e">// Set the database id to the converted object</span>
        <span style="color: #f8f8f2">myObject.DatabaseId</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse.ObjectId;</span>
        <span style="color: #75715e">// Save the old object so we can compare upstairs</span>
        <span style="color: #f8f8f2">_myObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myObject;</span>

        <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.Component.ExpireSolution(</span><span style="color: #66d9ef">true</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">}));</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">// &lt;Custom additional code&gt; </span>
  <span style="color: #f8f8f2">RhinoConverter</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>
  <span style="color: #f8f8f2">SpeckleObject</span> <span style="color: #f8f8f2">myObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>
  <span style="color: #f8f8f2">ResponsePostObject</span> <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>
  <span style="color: #f8f8f2">SpeckleObject</span> <span style="color: #f8f8f2">_myObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">SpeckleObject()</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">Hash</span> <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">};</span>
  <span style="color: #75715e">// &lt;/Custom additional code&gt; </span>
</pre></div>
</p>

<h2 id="create-many-objects">Create Many Objects</h2>

<p>Slightly different, and introduces the complexity of understanding if we actually have a new request or not.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>  <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">RunScript</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Client,</span> <span style="color: #f8f8f2">List&lt;GeometryBase&gt;</span> <span style="color: #f8f8f2">Objs,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Response,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">SpkObjects)</span>
  <span style="color: #f8f8f2">{</span>
    <span style="color: #75715e">// set output first</span>
    <span style="color: #f8f8f2">Response</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse;</span>
    <span style="color: #f8f8f2">SpkObjects</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myObjects;</span>

    <span style="color: #75715e">// Get and cast the client</span>
    <span style="color: #f8f8f2">BaseSpeckleApiClient</span> <span style="color: #f8f8f2">myClient</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Client</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">BaseSpeckleApiClient;</span>

    <span style="color: #75715e">// Return if null</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myClient</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>

    <span style="color: #75715e">// Create a fresh converter if we don&#39;t have one</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myConverter</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RhinoConverter();</span>

    <span style="color: #75715e">// Exit if no object to send to the db</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(Objs</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span> <span style="color: #f8f8f2">||</span> <span style="color: #f8f8f2">Objs.Count</span> <span style="color: #f8f8f2">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>

    <span style="color: #75715e">// Convert the object</span>
    <span style="color: #f8f8f2">myObjects</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myConverter.ToSpeckle(Objs).ToList();</span>

    <span style="color: #75715e">// Calculate a hash for the request</span>
    <span style="color: #66d9ef">var</span> <span style="color: #f8f8f2">bigHash</span> <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">myObjects.ForEach(obj</span> <span style="color: #f8f8f2">=&gt;</span> <span style="color: #f8f8f2">bigHash</span> <span style="color: #f8f8f2">+=</span> <span style="color: #f8f8f2">obj.Hash);</span>
    <span style="color: #66d9ef">var</span> <span style="color: #f8f8f2">requestHash</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">CreateMD5(bigHash);</span>

    <span style="color: #75715e">// Check if we have a new request.</span>
    <span style="color: #75715e">// Note: this is not a good way of doing it; the grasshopper sender</span>
    <span style="color: #75715e">// component takes care of this by doing a diff on the list, and implements</span>
    <span style="color: #75715e">// a cache too, so that previously sent objects do not get sent again.</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(requestHash</span> <span style="color: #f8f8f2">!=</span> <span style="color: #f8f8f2">_requestHash)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #75715e">// Create a payload and put in the converted objects</span>
      <span style="color: #f8f8f2">PayloadMultipleObjects</span> <span style="color: #f8f8f2">myPayload</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">PayloadMultipleObjects()</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">Objects</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myObjects</span> <span style="color: #f8f8f2">};</span>

      <span style="color: #f8f8f2">myClient.ObjectCreateBulkAsync(myPayload).ContinueWith(tres</span> <span style="color: #f8f8f2">=&gt;</span>
        <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">tres.Result;</span>

        <span style="color: #75715e">// Set the database id to the converted objects</span>
        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">k</span> <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
        <span style="color: #f8f8f2">myResponse.Objects.ForEach(id</span> <span style="color: #f8f8f2">=&gt;</span>
          <span style="color: #f8f8f2">{</span>
          <span style="color: #f8f8f2">myObjects[k++].DatabaseId</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">id;</span>
          <span style="color: #f8f8f2">});</span>

        <span style="color: #75715e">// Save the request hash</span>
        <span style="color: #f8f8f2">_requestHash</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">requestHash;</span>

        <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.Component.ExpireSolution(</span><span style="color: #66d9ef">true</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">});</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">// &lt;Custom additional code&gt; </span>
  <span style="color: #f8f8f2">RhinoConverter</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>
  <span style="color: #f8f8f2">List&lt;SpeckleObject&gt;</span> <span style="color: #f8f8f2">myObjects</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>
  <span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">_requestHash</span> <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">;</span>
  <span style="color: #f8f8f2">ResponsePostObjects</span> <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>


  <span style="color: #75715e">// ref: https://msdn.microsoft.com/en-us/library/system.security.cryptography.md5%28v=vs.110%29.aspx</span>
  <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">string</span> <span style="color: #a6e22e">CreateMD5</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">input)</span>
  <span style="color: #f8f8f2">{</span>
    <span style="color: #75715e">// Use input string to calculate MD5 hash</span>
    <span style="color: #66d9ef">using</span> <span style="color: #f8f8f2">(System.Security.Cryptography.MD5</span> <span style="color: #f8f8f2">md5</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">System.Security.Cryptography.MD5.Create())</span>
    <span style="color: #f8f8f2">{</span>
      <span style="color: #66d9ef">byte</span><span style="color: #f8f8f2">[]</span> <span style="color: #f8f8f2">inputBytes</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">System.Text.Encoding.ASCII.GetBytes(input);</span>
      <span style="color: #66d9ef">byte</span><span style="color: #f8f8f2">[]</span> <span style="color: #f8f8f2">hashBytes</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">md5.ComputeHash(inputBytes);</span>

      <span style="color: #75715e">// Convert the byte array to hexadecimal string</span>
      <span style="color: #f8f8f2">System.Text.StringBuilder</span> <span style="color: #f8f8f2">sb</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">System.Text.StringBuilder();</span>
      <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f8f8f2">&lt;</span> <span style="color: #f8f8f2">hashBytes.Length;</span> <span style="color: #f8f8f2">i++)</span>
      <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">sb.Append(hashBytes[i].ToString(</span><span style="color: #e6db74">&quot;X2&quot;</span><span style="color: #f8f8f2">));</span>
      <span style="color: #f8f8f2">}</span>
      <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">sb.ToString();</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">// &lt;/Custom additional code&gt; </span>
</pre></div>
</p>

<h2 id="get-object">Get Object</h2>

<p>Gets a Speckle Object by its database id.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">RunScript</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Client,</span> <span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">ObjectId,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">Response,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">SpkObject,</span> <span style="color: #66d9ef">ref</span> <span style="color: #66d9ef">object</span> <span style="color: #f8f8f2">RhObject)</span>
  <span style="color: #f8f8f2">{</span>
    <span style="color: #75715e">// Get and cast the client</span>
    <span style="color: #f8f8f2">BaseSpeckleApiClient</span> <span style="color: #f8f8f2">myClient</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Client</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">BaseSpeckleApiClient;</span>

    <span style="color: #75715e">// Create a fresh converter if we don&#39;t have one</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myConverter</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RhinoConverter();</span>

    <span style="color: #75715e">// Set outputs</span>
    <span style="color: #f8f8f2">Response</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse;</span>
    <span style="color: #f8f8f2">SpkObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myObject;</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myObject</span> <span style="color: #f8f8f2">!=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">RhObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myConverter.ToNative(myObject);</span>

    <span style="color: #75715e">// Check if we have a new request</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(ObjectId</span> <span style="color: #f8f8f2">!=</span> <span style="color: #f8f8f2">_ObjectId)</span>
      <span style="color: #f8f8f2">Rhino.RhinoApp.MainApplicationWindow.Invoke(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Action(()</span> <span style="color: #f8f8f2">=&gt;</span>
        <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">_ObjectId</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">ObjectId;</span>

        <span style="color: #75715e">// Note: Since this is Rhino, we can omit the &#39;displayValue&#39; field for</span>
        <span style="color: #75715e">// any objects we get back, as the converter relies on the encoded value.</span>
        <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myClient.ObjectGet(</span><span style="color: #e6db74">&quot;omit=displayValue&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">ObjectId);</span>
        <span style="color: #f8f8f2">myObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse.SpeckleObject;</span>
        <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.Component.ExpireSolution(</span><span style="color: #66d9ef">true</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">}));</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">// &lt;Custom additional code&gt; </span>

  <span style="color: #f8f8f2">RhinoConverter</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

  <span style="color: #f8f8f2">SpeckleObject</span> <span style="color: #f8f8f2">myObject</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

  <span style="color: #f8f8f2">ResponseObjectGet</span> <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

  <span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">_ObjectId</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

  <span style="color: #75715e">// &lt;/Custom additional code&gt; </span>
<span style="color: #f8f8f2">});</span>
</pre></div>
</p>

<h2 id="get-many-objects">Get Many Objects</h2>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span> <span style="color: #75715e">// Get and cast the client</span>
    <span style="color: #f8f8f2">BaseSpeckleApiClient</span> <span style="color: #f8f8f2">myClient</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">Client</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">BaseSpeckleApiClient;</span>

    <span style="color: #75715e">// Create a fresh converter if we don&#39;t have one</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myConverter</span> <span style="color: #f8f8f2">==</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RhinoConverter();</span>

    <span style="color: #75715e">// Set outputs</span>
    <span style="color: #f8f8f2">Response</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse;</span>
    <span style="color: #f8f8f2">SpkObjects</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myObjects;</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(myObjects</span> <span style="color: #f8f8f2">!=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">RhObjects</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myConverter.ToNative(myObjects);</span>


    <span style="color: #f8f8f2">PayloadObjectGetBulk</span> <span style="color: #f8f8f2">myPayload</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">PayloadObjectGetBulk()</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">Objects</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">ObjectIds</span> <span style="color: #f8f8f2">};</span>

    <span style="color: #75715e">// Check if we have a new request: this is a bad way of doing it</span>
    <span style="color: #75715e">// Quite inelegant, but here&#39;s to hacks</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(_myPayload.ToJson()</span> <span style="color: #f8f8f2">!=</span> <span style="color: #f8f8f2">myPayload.ToJson())</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">_myPayload</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myPayload;</span>
      <span style="color: #f8f8f2">myClient.ObjectGetBulkAsync(</span><span style="color: #e6db74">&quot;omit=displayValue&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">myPayload).ContinueWith(tres</span> <span style="color: #f8f8f2">=&gt;</span>
        <span style="color: #f8f8f2">{</span>

        <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">tres.Result;</span>
        <span style="color: #f8f8f2">myObjects</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">myResponse.Objects;</span>
        <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.Component.ExpireSolution(</span><span style="color: #66d9ef">true</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">});</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">// &lt;Custom additional code&gt; </span>

  <span style="color: #f8f8f2">RhinoConverter</span> <span style="color: #f8f8f2">myConverter</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

  <span style="color: #f8f8f2">List&lt;SpeckleObject&gt;</span> <span style="color: #f8f8f2">myObjects</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

  <span style="color: #f8f8f2">ResponseGetObjects</span> <span style="color: #f8f8f2">myResponse</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

  <span style="color: #f8f8f2">PayloadObjectGetBulk</span> <span style="color: #f8f8f2">_myPayload</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">PayloadObjectGetBulk();</span>
</pre></div>
</p>

<h2 id="going-further">Going Further:</h2>

<p>You can basically prototype/play with any methods that talk with the SpeckleApi:</p>

<ul>
<li>updating objects</li>
<li>creating, updating, diffing and cloning streams</li>
<li>adding layers to streams</li>
<li>[&hellip;]</li>
</ul>

<p>Hope this wet your appetite.</p>

      </div>
      
    </div>
  </div>
   <div class="footer blue">
  <div class="grid">
  <br>
  <br>
  <br>
    <div class="row">
      <div class='col col-9-of-12 col-m-4-of-4'>

      <p class="xxsubheading">
        Get in touch on <a href="https://slacker.speckle.works/" style='border:none'><i class='fa fa-slack'></i> Slack</a>!
        <hr>
      </p>
      
      
      <p class="paragraph">
          This project has received funding from the European Unionâs Horizon 2020 research and innovation program under the Marie Sklodowska-Curie grant agreement No 642877.
      </p>
      <br>
      <br>
      <br>
      <p class="paragraph"><small>Â© 2015 - 2018 <a href="http://dimitrie.org">Dimitrie Stefanescu</a>, <a href="https://www.ucl.ac.uk/bartlett/" class="href">UCL The Bartlett</a>, <a href="http://innochain.net/">InnoChain</a> & Project Contributors. <a href='http://twitter.com/idid'>i did</a> this.</small></p> 
      </div>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div class="col col-3-of-12 text-right">
        <a class="logo-img" href="https://speckle.works"><img src="/img/logos/2xlogo-white.png" style="width: 75px;"> </a>
      </div>
    </div>
  </div>
</div>
<script async defer src="/js/scripts.js"></script>
</body>
</html>